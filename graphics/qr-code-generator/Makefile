# $OpenBSD: $

COMMENT =		QR Code generator library
GH_ACCOUNT =		nayuki
GH_PROJECT =		QR-Code-generator
GH_TAGNAME =		v1.7.0
PKGNAME =		${DISTNAME:L}
CATEGORIES =		graphics

# upstream has no shared library versions, keep all in sync
LIBVER =		0.0
SHARED_LIBS +=		qrcodegen	${LIBVER}
SHARED_LIBS +=		qrcodegencpp	${LIBVER}

HOMEPAGE =		https://www.nayuki.io/page/qr-code-generator-library

# MIT
PERMIT_PACKAGE =	Yes

WANTLIB =		${COMPILER_LIBCXX} m

MAINTAINER =		Klemens Nanni <kn@openbsd.org>

COMPILER =		base-clang ports-gcc

SEPARATE_BUILD =	Yes

do-build:
	cd ${WRKSRC}/c && ${CC} ${CFLAGS} -shared qrcodegen.c \
	    -o ${WRKBUILD}/libqrcodegen.so.${LIBqrcodegen_VERSION}
	cd ${WRKSRC}/cpp && ${CXX} ${CXXFLAGS} -shared -fPIC qrcodegen.cpp \
	    -o ${WRKBUILD}/libqrcodegencpp.so.${LIBqrcodegencpp_VERSION}

do-install:
	${INSTALL_DATA} ${WRKSRC}/{c/*.h,cpp/*.hpp} ${PREFIX}/include/
	${INSTALL_DATA} ${WRKBUILD}/*.so* ${PREFIX}/lib/

do-test:
	cd ${WRKSRC}/c && ${CC} ${CFLAGS} -DQRCODEGEN_TEST qrcodegen{,-test}.c \
	    -o ${WRKBUILD}/qrcodegen-test
	${WRKBUILD}/qrcodegen-test

.include <bsd.port.mk>
